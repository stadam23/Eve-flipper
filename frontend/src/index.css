@import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap");

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===================================================================
   Theme system: palette × mode (dark/light)
   Color vars are RGB triplets so Tailwind opacity modifiers work:
     bg-eve-accent/10  →  rgb(var(--eve-accent) / 0.1)
   Direct CSS usage:  rgb(var(--eve-accent))
   =================================================================== */

/* ---------- DARK palettes ---------- */

/* Classic EVE gold — default */
:root,
[data-palette="classic"][data-mode="dark"] {
  --eve-dark: 13 13 13;
  --eve-panel: 26 26 26;
  --eve-panel-hover: 34 34 34;
  --eve-input: 35 35 35;
  --eve-accent: 230 149 0;
  --eve-accent-hover: 240 165 0;
  --eve-accent-dim: 179 116 0;
  --eve-text: 192 192 192;
  --eve-dim: 140 140 140;
  --eve-success: 0 180 80;
  --eve-error: 220 60 60;
  --eve-warning: 230 149 0;
  --eve-border: 42 42 42;
  --eve-border-light: 58 58 58;
  --eve-glow: rgba(230, 149, 0, 0.15);
  --eve-selection: rgba(230, 149, 0, 0.3);
  --eve-scrollbar-track: #0d0d0d;
  --eve-scrollbar-thumb: #3a3a3a;
  --eve-scrollbar-thumb-hover: #555;
}

/* Caldari blue */
[data-palette="caldari"][data-mode="dark"] {
  --eve-dark: 10 14 20;
  --eve-panel: 17 24 32;
  --eve-panel-hover: 26 34 48;
  --eve-input: 22 30 40;
  --eve-accent: 74 158 255;
  --eve-accent-hover: 106 180 255;
  --eve-accent-dim: 42 108 192;
  --eve-text: 184 200 216;
  --eve-dim: 106 122 138;
  --eve-success: 0 180 80;
  --eve-error: 220 60 60;
  --eve-warning: 230 149 0;
  --eve-border: 30 42 56;
  --eve-border-light: 42 58 74;
  --eve-glow: rgba(74, 158, 255, 0.15);
  --eve-selection: rgba(74, 158, 255, 0.3);
  --eve-scrollbar-track: #0a0e14;
  --eve-scrollbar-thumb: #2a3a4a;
  --eve-scrollbar-thumb-hover: #3a5060;
}

/* Amarr gold */
[data-palette="amarr"][data-mode="dark"] {
  --eve-dark: 18 16 10;
  --eve-panel: 30 26 16;
  --eve-panel-hover: 40 34 26;
  --eve-input: 34 32 24;
  --eve-accent: 255 215 0;
  --eve-accent-hover: 255 224 64;
  --eve-accent-dim: 192 160 0;
  --eve-text: 208 200 176;
  --eve-dim: 138 128 104;
  --eve-success: 0 180 80;
  --eve-error: 220 60 60;
  --eve-warning: 230 149 0;
  --eve-border: 42 38 24;
  --eve-border-light: 58 52 40;
  --eve-glow: rgba(255, 215, 0, 0.12);
  --eve-selection: rgba(255, 215, 0, 0.3);
  --eve-scrollbar-track: #12100a;
  --eve-scrollbar-thumb: #3a3428;
  --eve-scrollbar-thumb-hover: #504838;
}

/* Minmatar red */
[data-palette="minmatar"][data-mode="dark"] {
  --eve-dark: 18 10 10;
  --eve-panel: 30 18 18;
  --eve-panel-hover: 42 26 26;
  --eve-input: 34 22 22;
  --eve-accent: 224 80 64;
  --eve-accent-hover: 240 96 80;
  --eve-accent-dim: 168 48 32;
  --eve-text: 200 176 176;
  --eve-dim: 138 106 106;
  --eve-success: 0 180 80;
  --eve-error: 220 60 60;
  --eve-warning: 230 149 0;
  --eve-border: 42 24 24;
  --eve-border-light: 58 40 40;
  --eve-glow: rgba(224, 80, 64, 0.15);
  --eve-selection: rgba(224, 80, 64, 0.3);
  --eve-scrollbar-track: #120a0a;
  --eve-scrollbar-thumb: #3a2828;
  --eve-scrollbar-thumb-hover: #504040;
}

/* Gallente green */
[data-palette="gallente"][data-mode="dark"] {
  --eve-dark: 10 18 10;
  --eve-panel: 18 30 18;
  --eve-panel-hover: 26 42 26;
  --eve-input: 22 34 22;
  --eve-accent: 64 192 96;
  --eve-accent-hover: 80 216 112;
  --eve-accent-dim: 40 144 64;
  --eve-text: 176 200 176;
  --eve-dim: 106 138 106;
  --eve-success: 64 192 96;
  --eve-error: 220 60 60;
  --eve-warning: 230 149 0;
  --eve-border: 24 42 24;
  --eve-border-light: 40 58 40;
  --eve-glow: rgba(64, 192, 96, 0.15);
  --eve-selection: rgba(64, 192, 96, 0.3);
  --eve-scrollbar-track: #0a120a;
  --eve-scrollbar-thumb: #283a28;
  --eve-scrollbar-thumb-hover: #405040;
}

/* Serpentis purple */
[data-palette="serpentis"][data-mode="dark"] {
  --eve-dark: 14 10 20;
  --eve-panel: 24 18 30;
  --eve-panel-hover: 34 26 42;
  --eve-input: 28 22 34;
  --eve-accent: 167 139 250;
  --eve-accent-hover: 191 160 255;
  --eve-accent-dim: 124 92 192;
  --eve-text: 192 184 208;
  --eve-dim: 122 106 138;
  --eve-success: 0 180 80;
  --eve-error: 220 60 60;
  --eve-warning: 230 149 0;
  --eve-border: 34 26 42;
  --eve-border-light: 50 40 56;
  --eve-glow: rgba(167, 139, 250, 0.15);
  --eve-selection: rgba(167, 139, 250, 0.3);
  --eve-scrollbar-track: #0e0a14;
  --eve-scrollbar-thumb: #322838;
  --eve-scrollbar-thumb-hover: #483e58;
}

/* ---------- LIGHT palettes ---------- */

[data-palette="classic"][data-mode="light"] {
  --eve-dark: 255 255 255;
  --eve-panel: 250 250 250;
  --eve-panel-hover: 245 245 245;
  --eve-input: 248 248 248;
  --eve-accent: 192 120 0;
  --eve-accent-hover: 160 101 0;
  --eve-accent-dim: 138 88 0;
  --eve-text: 42 42 42;
  --eve-dim: 106 106 106;
  --eve-success: 0 138 58;
  --eve-error: 192 32 32;
  --eve-warning: 192 120 0;
  --eve-border: 228 228 228;
  --eve-border-light: 212 212 212;
  --eve-glow: rgba(192, 120, 0, 0.1);
  --eve-selection: rgba(192, 120, 0, 0.2);
  --eve-scrollbar-track: #f5f5f5;
  --eve-scrollbar-thumb: #d0d0d0;
  --eve-scrollbar-thumb-hover: #b0b0b0;
}

[data-palette="caldari"][data-mode="light"] {
  --eve-dark: 255 255 255;
  --eve-panel: 250 250 250;
  --eve-panel-hover: 245 245 245;
  --eve-input: 248 248 248;
  --eve-accent: 26 110 192;
  --eve-accent-hover: 10 90 160;
  --eve-accent-dim: 24 96 168;
  --eve-text: 42 42 42;
  --eve-dim: 106 106 106;
  --eve-success: 0 138 58;
  --eve-error: 192 32 32;
  --eve-warning: 192 120 0;
  --eve-border: 228 228 228;
  --eve-border-light: 212 212 212;
  --eve-glow: rgba(26, 110, 192, 0.1);
  --eve-selection: rgba(26, 110, 192, 0.2);
  --eve-scrollbar-track: #f5f5f5;
  --eve-scrollbar-thumb: #d0d0d0;
  --eve-scrollbar-thumb-hover: #b0b0b0;
}

[data-palette="amarr"][data-mode="light"] {
  --eve-dark: 255 255 255;
  --eve-panel: 250 250 250;
  --eve-panel-hover: 245 245 245;
  --eve-input: 248 248 248;
  --eve-accent: 160 128 0;
  --eve-accent-hover: 136 106 0;
  --eve-accent-dim: 122 98 0;
  --eve-text: 42 42 42;
  --eve-dim: 106 106 106;
  --eve-success: 0 138 58;
  --eve-error: 192 32 32;
  --eve-warning: 192 120 0;
  --eve-border: 228 228 228;
  --eve-border-light: 212 212 212;
  --eve-glow: rgba(160, 128, 0, 0.1);
  --eve-selection: rgba(160, 128, 0, 0.2);
  --eve-scrollbar-track: #f5f5f5;
  --eve-scrollbar-thumb: #d0d0d0;
  --eve-scrollbar-thumb-hover: #b0b0b0;
}

[data-palette="minmatar"][data-mode="light"] {
  --eve-dark: 255 255 255;
  --eve-panel: 250 250 250;
  --eve-panel-hover: 245 245 245;
  --eve-input: 248 248 248;
  --eve-accent: 184 48 32;
  --eve-accent-hover: 160 40 24;
  --eve-accent-dim: 136 32 24;
  --eve-text: 42 42 42;
  --eve-dim: 106 106 106;
  --eve-success: 0 138 58;
  --eve-error: 192 32 32;
  --eve-warning: 192 120 0;
  --eve-border: 228 228 228;
  --eve-border-light: 212 212 212;
  --eve-glow: rgba(184, 48, 32, 0.1);
  --eve-selection: rgba(184, 48, 32, 0.2);
  --eve-scrollbar-track: #f5f5f5;
  --eve-scrollbar-thumb: #d0d0d0;
  --eve-scrollbar-thumb-hover: #b0b0b0;
}

[data-palette="gallente"][data-mode="light"] {
  --eve-dark: 255 255 255;
  --eve-panel: 250 250 250;
  --eve-panel-hover: 245 245 245;
  --eve-input: 248 248 248;
  --eve-accent: 26 138 58;
  --eve-accent-hover: 16 112 40;
  --eve-accent-dim: 10 96 32;
  --eve-text: 42 42 42;
  --eve-dim: 106 106 106;
  --eve-success: 26 138 58;
  --eve-error: 192 32 32;
  --eve-warning: 192 120 0;
  --eve-border: 228 228 228;
  --eve-border-light: 212 212 212;
  --eve-glow: rgba(26, 138, 58, 0.1);
  --eve-selection: rgba(26, 138, 58, 0.2);
  --eve-scrollbar-track: #f5f5f5;
  --eve-scrollbar-thumb: #d0d0d0;
  --eve-scrollbar-thumb-hover: #b0b0b0;
}

[data-palette="serpentis"][data-mode="light"] {
  --eve-dark: 255 255 255;
  --eve-panel: 250 250 250;
  --eve-panel-hover: 245 245 245;
  --eve-input: 248 248 248;
  --eve-accent: 124 92 192;
  --eve-accent-hover: 106 72 168;
  --eve-accent-dim: 90 60 144;
  --eve-text: 42 42 42;
  --eve-dim: 106 106 106;
  --eve-success: 0 138 58;
  --eve-error: 192 32 32;
  --eve-warning: 192 120 0;
  --eve-border: 228 228 228;
  --eve-border-light: 212 212 212;
  --eve-glow: rgba(124, 92, 192, 0.1);
  --eve-selection: rgba(124, 92, 192, 0.2);
  --eve-scrollbar-track: #f5f5f5;
  --eve-scrollbar-thumb: #d0d0d0;
  --eve-scrollbar-thumb-hover: #b0b0b0;
}

/* ===================================================================
   Base layer
   =================================================================== */

@layer base {
  * {
    border-color: rgb(var(--eve-border));
  }

  body {
    background-color: rgb(var(--eve-dark));
    color: rgb(var(--eve-text));
    font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Consolas, Monaco, monospace;
    font-size: 0.875rem;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overflow: hidden;
  }

  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--eve-scrollbar-track); }
  ::-webkit-scrollbar-thumb { background: var(--eve-scrollbar-thumb); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--eve-scrollbar-thumb-hover); }

  ::selection {
    background: var(--eve-selection);
    color: inherit;
  }

  /* Prevent double-tap zoom on interactive elements (mobile) */
  button, a, [role="tab"], input, select {
    touch-action: manipulation;
  }
}

/* ===================================================================
   Responsive utilities
   =================================================================== */

/* Table scroll container: smooth momentum + edge shadow indicators */
.table-scroll-wrapper {
  position: relative;
}

.table-scroll-container {
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
}

/* Explicit themed scrollbar for inner panels/tables (Windows-friendly). */
.eve-scrollbar {
  scrollbar-width: thin;
  scrollbar-color: var(--eve-scrollbar-thumb) var(--eve-scrollbar-track);
}

.eve-scrollbar::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

.eve-scrollbar::-webkit-scrollbar-track {
  background: var(--eve-scrollbar-track);
  border-left: 1px solid rgb(var(--eve-border));
}

.eve-scrollbar::-webkit-scrollbar-thumb {
  background: linear-gradient(
    180deg,
    var(--eve-scrollbar-thumb) 0%,
    var(--eve-scrollbar-thumb-hover) 100%
  );
  border: 2px solid var(--eve-scrollbar-track);
  border-radius: 6px;
}

.eve-scrollbar::-webkit-scrollbar-thumb:hover {
  background: var(--eve-scrollbar-thumb-hover);
}

.eve-scrollbar::-webkit-scrollbar-corner {
  background: var(--eve-scrollbar-track);
}

/* Gradient fade on right edge to hint horizontal scroll */
.table-scroll-wrapper::after {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  width: 24px;
  pointer-events: none;
  background: linear-gradient(to right, transparent, rgb(var(--eve-panel)));
  opacity: 0.8;
  z-index: 5;
}

/* Opt-out for tables where right-edge fade may cover narrow numeric columns. */
.table-scroll-wrapper.table-scroll-no-fade::after {
  display: none;
}

/* Safe area insets for notched phones */
@supports (padding: env(safe-area-inset-bottom)) {
  body {
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
    padding-bottom: env(safe-area-inset-bottom);
  }
}

/* Wider touch scrollbars on mobile */
@media (pointer: coarse) {
  ::-webkit-scrollbar { width: 8px; height: 8px; }
  ::-webkit-scrollbar-thumb { min-height: 40px; }
}

/* ===================================================================
   Discord icon animation (every 3 minutes)
   =================================================================== */

@keyframes discord-pulse {
  0%, 97% {
    filter: drop-shadow(0 0 0 transparent);
    transform: scale(1);
  }
  98% {
    filter: drop-shadow(0 0 8px rgb(var(--eve-accent)));
    transform: scale(1.15);
  }
  98.5% {
    filter: drop-shadow(0 0 12px rgb(var(--eve-accent)));
    transform: scale(1.2);
  }
  99% {
    filter: drop-shadow(0 0 8px rgb(var(--eve-accent)));
    transform: scale(1.15);
  }
  100% {
    filter: drop-shadow(0 0 0 transparent);
    transform: scale(1);
  }
}

.discord-icon-animated {
  animation: discord-pulse 360s ease-in-out infinite;
}

/* ===================================================================
   Station AI chat surface (visually separated from dashboard)
   =================================================================== */

.ai-chat-window {
  border-color: rgb(var(--eve-accent) / 0.36);
  background:
    radial-gradient(circle at 16% -4%, rgb(var(--eve-accent) / 0.18), transparent 42%),
    linear-gradient(180deg, rgb(var(--eve-panel) / 0.98), rgb(var(--eve-dark) / 0.96));
  box-shadow:
    0 22px 46px rgb(0 0 0 / 0.46),
    0 0 0 1px rgb(var(--eve-border-light) / 0.64),
    inset 0 1px 0 rgb(var(--eve-border-light) / 0.2);
}

.ai-chat-header {
  border-bottom-color: rgb(var(--eve-accent) / 0.28);
  background:
    linear-gradient(180deg, rgb(var(--eve-panel-hover) / 0.92), rgb(var(--eve-panel) / 0.82));
}

.ai-chat-sidebar {
  border-color: rgb(var(--eve-border-light) / 0.58);
  background:
    linear-gradient(180deg, rgb(var(--eve-dark) / 0.78), rgb(var(--eve-panel) / 0.56));
}

.ai-chat-main {
  background:
    linear-gradient(180deg, rgb(var(--eve-dark) / 0.64), rgb(var(--eve-panel) / 0.5));
}

.ai-chat-context-strip {
  border-bottom-color: rgb(var(--eve-border-light) / 0.54);
  background: rgb(var(--eve-dark) / 0.46);
}

.ai-chat-progress-panel {
  border-bottom-color: rgb(var(--eve-border-light) / 0.5);
  background:
    linear-gradient(180deg, rgb(var(--eve-dark) / 0.54), rgb(var(--eve-dark) / 0.34));
}

.ai-chat-thread {
  background:
    linear-gradient(180deg, rgb(var(--eve-dark) / 0.26), rgb(var(--eve-dark) / 0.14));
}

.ai-chat-bubble {
  box-shadow:
    inset 0 1px 0 rgb(var(--eve-border-light) / 0.08);
}

.ai-chat-bubble--assistant {
  border-color: rgb(var(--eve-accent) / 0.52);
  background:
    linear-gradient(
      180deg,
      rgb(var(--eve-accent) / 0.16),
      rgb(var(--eve-accent-dim) / 0.08)
    );
}

.ai-chat-bubble--user {
  border-color: rgb(var(--eve-border-light) / 0.66);
  background:
    linear-gradient(180deg, rgb(var(--eve-dark) / 0.82), rgb(var(--eve-panel) / 0.66));
}

.ai-chat-footer {
  border-top-color: rgb(var(--eve-border-light) / 0.58);
  background: rgb(var(--eve-dark) / 0.42);
}

.ai-chat-composer-shell {
  border-color: rgb(var(--eve-border-light) / 0.64);
  background:
    linear-gradient(180deg, rgb(var(--eve-panel) / 0.78), rgb(var(--eve-dark) / 0.62));
}

.ai-chat-input {
  border-color: rgb(var(--eve-border-light) / 0.72);
  background: rgb(var(--eve-input) / 0.84);
}

.ai-chat-input:focus {
  border-color: rgb(var(--eve-accent) / 0.68);
  box-shadow:
    0 0 0 1px rgb(var(--eve-accent) / 0.36),
    0 0 18px rgb(var(--eve-accent) / 0.14);
}

.ai-chat-tools-popover {
  border-color: rgb(var(--eve-accent) / 0.38);
  background:
    linear-gradient(180deg, rgb(var(--eve-panel) / 0.98), rgb(var(--eve-dark) / 0.92));
  box-shadow:
    0 16px 30px rgb(0 0 0 / 0.44),
    0 0 0 1px rgb(var(--eve-border-light) / 0.5);
}

[data-mode="light"] .ai-chat-window {
  box-shadow:
    0 16px 36px rgb(20 22 28 / 0.22),
    0 0 0 1px rgb(var(--eve-border-light) / 0.7),
    inset 0 1px 0 rgb(255 255 255 / 0.74);
}

[data-mode="light"] .ai-chat-thread {
  background:
    linear-gradient(180deg, rgb(var(--eve-dark) / 0.58), rgb(var(--eve-dark) / 0.4));
}

[data-mode="light"] .ai-chat-bubble--user {
  background:
    linear-gradient(180deg, rgb(var(--eve-dark) / 0.74), rgb(var(--eve-dark) / 0.58));
}

/* ===================================================================
   Ivy AI mascot (pixel-art header sprite)
   =================================================================== */

.ai-ivy-mascot {
  --ivy-pixel-size: 3px;
  width: 48px;
  height: 48px;
  flex: 0 0 auto;
  display: grid;
  place-items: center;
  cursor: pointer;
  border: 1px solid rgb(var(--eve-border-light));
  background:
    radial-gradient(circle at 35% 25%, rgb(var(--eve-accent) / 0.22), transparent 56%),
    linear-gradient(180deg, rgb(var(--eve-panel-hover)), rgb(var(--eve-dark)));
  box-shadow:
    inset 0 0 0 1px rgb(var(--eve-border) / 0.75),
    0 0 14px rgb(var(--eve-accent) / 0.18);
  animation: ivy-float 2.3s steps(2, end) infinite;
  transition: filter 140ms linear, box-shadow 140ms linear;
}

.ai-ivy-mascot--thinking {
  animation-duration: 1.2s;
  box-shadow:
    inset 0 0 0 1px rgb(var(--eve-border) / 0.75),
    0 0 16px rgb(var(--eve-accent) / 0.25);
}

.ai-ivy-mascot-grid {
  width: calc(var(--ivy-pixel-size) * 12);
  height: calc(var(--ivy-pixel-size) * 12);
  display: grid;
  grid-template-columns: repeat(12, var(--ivy-pixel-size));
  grid-template-rows: repeat(12, var(--ivy-pixel-size));
  image-rendering: pixelated;
}

.ai-ivy-pixel {
  width: var(--ivy-pixel-size);
  height: var(--ivy-pixel-size);
}

.ai-ivy-pixel--o {
  background: rgb(var(--eve-border-light));
}

.ai-ivy-pixel--b {
  background: rgb(var(--eve-accent-dim));
}

.ai-ivy-pixel--g {
  background: rgb(var(--eve-accent));
}

.ai-ivy-pixel--a {
  background: rgb(var(--eve-accent-hover));
}

.ai-ivy-pixel--e {
  background: rgb(var(--eve-dark));
}

.ai-ivy-pixel--eye {
  transform-origin: center;
  animation: ivy-blink 4.4s steps(1, end) infinite;
}

@media (hover: hover) and (pointer: fine) {
  .ai-ivy-mascot:hover {
    filter: saturate(1.25);
    box-shadow:
      inset 0 0 0 1px rgb(var(--eve-border) / 0.75),
      0 0 18px rgb(var(--eve-accent) / 0.35);
    animation: ivy-hover-bob 0.55s steps(2, end) infinite;
  }

  .ai-ivy-mascot:hover .ai-ivy-mascot-grid {
    animation: ivy-hover-jitter 460ms steps(2, end) infinite;
  }

  .ai-ivy-mascot:hover .ai-ivy-pixel--eye {
    animation: ivy-eye-dart 720ms steps(2, end) infinite;
  }

  .ai-ivy-mascot:hover .ai-ivy-pixel--mouth {
    animation: ivy-mouth-talk 380ms steps(2, end) infinite;
  }
}

@keyframes ivy-float {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-2px);
  }
}

@keyframes ivy-blink {
  0%, 92%, 100% {
    transform: scaleY(1);
  }
  94%, 96% {
    transform: scaleY(0.2);
  }
}

@keyframes ivy-hover-bob {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-3px);
  }
}

@keyframes ivy-hover-jitter {
  0%, 100% {
    transform: translate(0, 0);
  }
  25% {
    transform: translate(1px, 0);
  }
  50% {
    transform: translate(0, -1px);
  }
  75% {
    transform: translate(-1px, 0);
  }
}

@keyframes ivy-eye-dart {
  0%, 100% {
    transform: scaleY(1) translateX(0);
  }
  20% {
    transform: scaleY(1) translateX(-1px);
  }
  40% {
    transform: scaleY(1) translateX(1px);
  }
  60% {
    transform: scaleY(0.2);
  }
  80% {
    transform: scaleY(1) translateX(0);
  }
}

@keyframes ivy-mouth-talk {
  0%, 100% {
    transform: scaleY(1);
    filter: brightness(1);
  }
  50% {
    transform: scaleY(0.35);
    filter: brightness(1.45);
  }
}

@media (prefers-reduced-motion: reduce) {
  .ai-ivy-mascot,
  .ai-ivy-pixel--eye,
  .ai-ivy-pixel--mouth,
  .ai-ivy-mascot-grid {
    animation: none;
  }
}
